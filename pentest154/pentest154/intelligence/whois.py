from datetime import datetime
from typing import Tuple
from whois import whois
from rich.tree import Tree
from rich import print


def get_whois_info(target: str) -> Tuple[Tree, str]:
	target_whois_data = whois(target)

	if target_whois_data['domain_name'] is None:
		print_msg('Invalid target. Please use IP or URL', 'error')
		print('\tExample: ./p154kit -t <IP Address / URL>')
		return

	current_datetime = datetime.now().strftime("%Y-%m-%d %H:%M:%S")

	report_data_tree = Tree('Репорт WHOIS')
	report_data_tree.add(f"Дата и время: {current_datetime}")
	report_data_tree.add(f"Цель: {target}")

	report_data_string = f'Тип=WHOIS\nОписание=Информация об IP адресе или URL, его владельце и другие данные о нем.\n'
	report_data_string += f"Дата и время={current_datetime}\nЦель={target}\n"

	for key, value in target_whois_data.items():
		report_data_tree.add(f'{key.upper()}={value}')
		report_data_string += f'{key.upper()}={value}\n'

	return (report_data_tree, report_data_string)
